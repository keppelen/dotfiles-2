#https://gist.github.com/maumercado/3354613

RED="\[\033[0;31m\]"
YELLOW="\[\033[0;33m\]"
GREEN="\[\033[0;32m\]"
BLUE="\[\033[0;34m\]"
NO_COLOUR="\[\033[0m\]"
CYAN="\[\033[0;36m\]"
PURPLE="\[\033[0;35m\]"
 
# Determine active Python virtualenv details.
function set_virtualenv () {
    if test -z "$VIRTUAL_ENV" ; then
        PYTHON_VIRTUALENV=""
    else
        PYTHON_VIRTUALENV="$CYAN(`basename \"$VIRTUAL_ENV\"`)${NO_COLOUR} "
    fi
}
 
function set_rvm_prompt () {
    local gemset=$(echo $GEM_HOME | awk -F'@' '{print $2}')
    [ "$gemset" != "" ] && echo "(@$gemset) "
}
 
function parse_git_branch () {
    git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/ (\1)/'
}
 
function set_git_branch () {
# Capture the output of the "git status" command.
 
    git_status="$(git status 2> /dev/null)"
    # Set color based on clean/staged/dirty.
    if [[ ${git_status} =~ .*"working directory clean".* ]]; then
        B_STATE="${GREEN}"
    elif [[ ${git_status} =~ .*"Changes to be committed".* ]]; then
        B_STATE="${YELLOW}"
    else
        B_STATE="${RED}"
    fi
}
 
prompt_cmd () {
    set_virtualenv
    set_git_branch
    #PS1="${PYTHON_VIRTUALENV}$PURPLE\$(set_rvm_prompt)$NO_COLOUR\u@\h $BLUE[\w]${B_STATE}\$(parse_git_branch)$NO_COLOUR \$ "
    PS1="\n${PYTHON_VIRTUALENV}$PURPLE\$(set_rvm_prompt)$NO_COLOUR\w${B_STATE}\$(parse_git_branch)$NO_COLOUR \$ "
}
 
PROMPT_COMMAND=prompt_cmd
